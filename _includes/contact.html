<section id="contact">
    <div class="container">
        <div class="row">
            <div class="col-lg-12 text-center">
                <h2 class="section-heading">협업 문의</h2>
            </div>
        </div>

        <div class="row">
            <div class="col-lg-12">
                <!-- action/method 제거 -->
                <form id="my-form">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="control-group form-group">
                                <input type="text" name="mail_title"" class=" form-control" id="email-subject"
                                    placeholder="Submission Subject*" required
                                    data-validation-required-message="Please submit the subject." />
                                <p class="help-block text-danger"></p>
                            </div>

                            <div class="control-group form-group">
                                <input type="text" name="mail_name" class="form-control" placeholder="Your Name *"
                                    id="full-name" required data-validation-required-message="Please enter your name.">
                                <p class="help-block text-danger"></p>
                            </div>

                            <div class="control-group form-group">
                                <input type="email" name="mail_email" class="form-control" placeholder="Your Email *"
                                    id="email-address" required
                                    data-validation-required-message="Please enter your email address.">
                                <p class="help-block text-danger"></p>
                            </div>

                            <div class="control-group form-group">
                                <input type="tel" name="mail_phone" class="form-control" placeholder="Your Phone *"
                                    id="telephone" required
                                    data-validation-required-message="Please enter your phone number.">
                                <p class="help-block text-danger"></p>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="control-group form-group">
                                <textarea name="mail_message" class="form-control" placeholder="Your Message *"
                                    id="message" required
                                    data-validation-required-message="Please enter a message."></textarea>
                                <p class="help-block text-danger"></p>
                            </div>
                        </div>

                        <div class="clearfix"></div>

                        <div class="col-lg-12 text-center">
                            <div id="success"></div>
                            <button type="submit" id="my-form-submit-button" class="btn btn-xl">Send Message</button>
                        </div>
                    </div>

                    <p id="my-form-status"></p>
                </form>

            </div>
        </div>

        <div class="col-lg-12 text-center">
            <hr />
            <br /><br /><br />
            <h4 class="section-heading">책 내용에 대한 문의는 카페를 이용해주세요</h4>
            <a href="https://cafe.naver.com/bhban">
                <!-- 중복 id 제거(필수) -->
                <button id="cafe-button" class="btn btn-xl">카페 바로가기</button>
            </a>
        </div>
    </div>

    <!-- EmailJS SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
    <script>
        // EmailJS Public Key로 교체
        emailjs.init("61GtFyVFJ4xDftkIG");
    </script>

    <!-- 전송 로직 -->
    <script>
        (function () {
            const form = document.getElementById("my-form");
            const statusEl = document.getElementById("my-form-status");
            const submitBtn = document.getElementById("my-form-submit-button");

            // EmailJS 값으로 교체
            const SERVICE_ID = "service_nicpl0u";
            const TEMPLATE_ID = "template_h4ve5sp";

            function setStatus(msg, isError) {
                if (!statusEl) return;
                statusEl.textContent = msg;
                statusEl.style.color = isError ? "red" : "inherit";
            }

            form.addEventListener("submit", async function (e) {
                e.preventDefault();

                // HTML required 검증이 안 돌 경우 대비
                if (!form.checkValidity()) {
                    setStatus("필수 항목을 입력해주세요.", true);
                    return;
                }

                submitBtn.disabled = true;
                setStatus("Sending...");

                // 템플릿 변수명은 EmailJS 템플릿에서 맞춰주세요
                const templateParams = {
                    subject: document.getElementById("email-subject").value,
                    from_name: document.getElementById("full-name").value,
                    reply_to: document.getElementById("email-address").value,
                    phone: document.getElementById("telephone").value,
                    message: document.getElementById("message").value
                };

                try {
                    await emailjs.send(SERVICE_ID, TEMPLATE_ID, templateParams);
                    setStatus("✅ 메시지가 전송되었습니다. 감사합니다!");
                    form.reset();
                } catch (err) {
                    console.error(err);
                    setStatus("❌ 전송에 실패했습니다. 잠시 후 다시 시도해주세요.", true);
                } finally {
                    submitBtn.disabled = false;
                }
            });
        })();
    </script>
</section>
